### 获取云服务器
本次演示选择的是华为云服务器，购买过程大概花费十分钟，如果是按需付费的话，便宜的机器有两三块钱一天的，来做一些服务器上的实践应该还是蛮不错的选择。在进行灰度发布实验的过程中，我买了两台机器，宽带按使用量付费，一天大概消耗六块钱。

#### 访问购买链接
https://console.huaweicloud.com/ecm/?region=cn-east-2#/ecs/createVm

#### 选择服务器规格
这里我选的是按需计费的鲲鹏通用计算增强型机器，价格是0.12元/小时，可根据个人情况选择按需购买还是包年包月。
![guige](./img/guige.png)

#### 选择镜像和系统盘
选择CentOS 8.0
![jingxiang](./img/jingxiang.png)

#### 选择网络
因为我只用来做一下灰度发布的演示，用不了几天，所以选择了按流量计费。
![wangluo](./img/wangluo.png)

#### 设置服务器密码
这个是服务器的登录密码，一定不能忘记。
![mima](./img/mima.png)

#### 确认信息
要确认的信息包括你刚刚选择的配置和购买的台数，因为要做灰度发布需要两台机器，所以我买了两台。一台也可以操作，就是会麻烦一点。记得勾选阅读并同意的checkbox，否则不能购买。
![two](./img/two.png)

#### 查看机器
点击购买后，可以再次点击弹出框按钮跳转到到控制台主界面。此时不需要付费，但是最好先充几十块钱进去，否则过一个多小时就会因为欠费而关机。在控制台这里，稍微等一会，可以看到已经有了两台服务器，并且都配备了公网地址。
![console](./img/console.png)

#### 登录服务器
可以在华为云控制台点击远程登录连接，或者在本地使用终端工具连接，我比较倾向于使用后一种办法。先测试一下看看两台服务器能否正常连接，确认无误后购买云服务器环节结束。
![login](./img/login.jpg)


#### 操作另一台服务器
接着，我们现在把本地代码中的title 改成B-CanaryDemo，然后用同样的方法打包，并把打包结果发送到第二台服务器上，记得在第二台服务器上也安装配置Nginx，然后手动测试一下第二台服务器的网站能否访问成功。至此，服务器的购买和两个“版本”代码的服务器部署已经完成。


### 灰度发布

#### 指定灰度策略
我们以cookie 为指标进行流量的分配。

#### 服务器安装Jenkins

#### 建立灰度发布相关的Jenkins任务

#### 配置Nginx灰度策略

#### 通过按钮调用Jenkins任务的执行


